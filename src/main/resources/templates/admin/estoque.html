<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gerenciar Estoque - VidaPlus</title>
    <th:block th:replace="~{fragments/favicon :: icone}"></th:block>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <div th:replace="~{fragments/header :: navbar}"></div>

    <main>
        <div class="main-content">
            
            <div class="stock-header">
                <h2 style="color: #333; margin: 0;"><i class="fas fa-boxes"></i> Controle de Estoque & Farmácia</h2>
                <button onclick="abrirModal()" class="btn-custom" style="width: auto; padding: 10px 20px;">
                    <i class="fas fa-plus"></i> Novo Item
                </button>
            </div>

            <div th:if="${mensagem}" class="alert-box alert-success" th:text="${mensagem}"></div>
            <div th:if="${erro}" class="alert-box alert-error" th:text="${erro}"></div>

            <div class="table-responsive" style="margin-top: 20px;">
                <table class="table-admin">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Produto</th>
                            <th>Descrição</th>
                            <th>Qtd Atual</th>
                            <th>Mínimo</th>
                            <th>Valor (R$)</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="produto : ${produtos}">
                            <td th:text="${produto.id}">1</td>
                            <td style="font-weight: bold; color: #333;" th:text="${produto.nome}">Dipirona</td>
                            <td th:text="${produto.descricao}">500mg comprimido</td>
                            
                            <td th:style="${produto.quantidade <= produto.quantidadeMinima} ? 'color: #e74c3c; font-weight: bold;' : ''" 
                                th:text="${produto.quantidade}">10</td>
                            
                            <td th:text="${produto.quantidadeMinima}">20</td>
                            <td th:text="${'R$ ' + #numbers.formatDecimal(produto.preco, 1, 2, 'COMMA')}">R$ 5,00</td>
                            
                            <td>
                                <span th:if="${produto.quantidade <= produto.quantidadeMinima}" class="badge-alerta">BAIXO</span>
                                <span th:unless="${produto.quantidade <= produto.quantidadeMinima}" class="badge-ok">NORMAL</span>
                            </td>

                            <td>
                                <a th:href="@{/admin/estoque/deletar/{id}(id=${produto.id})}" 
                                   class="btn-action btn-delete"
                                   title="Excluir Item"
                                   onclick="return confirm('Tem certeza que deseja excluir este produto?')">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(produtos)}">
                            <td colspan="8" style="text-align:center; padding: 30px; color: #999;">
                                <i class="fas fa-box-open" style="font-size: 2rem; display: block; margin-bottom: 10px;"></i>
                                Nenhum produto cadastrado no estoque.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="modalProduto" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModal()">&times;</span>
            <h3 style="margin-bottom: 20px; color: #20c997;">Cadastrar Novo Produto</h3>
            
            <form th:action="@{/admin/estoque/salvar}" method="post">
                
                <div class="form-group">
                    <label>Nome do Medicamento/Item:</label>
                    <input type="text" name="nome" required placeholder="Ex: Paracetamol 750mg" class="form-control">
                </div>

                <div class="form-group">
                    <label>Descrição Detalhada:</label>
                    <input type="text" name="descricao" placeholder="Ex: Caixa com 20 comprimidos" class="form-control">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Qtd Inicial:</label>
                        <input type="number" name="quantidade" required min="0" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Estoque Mínimo:</label>
                        <input type="number" name="quantidadeMinima" required min="1" value="10" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label>Preço Unitário (R$):</label>
                    <input type="number" name="preco" step="0.01" min="0" placeholder="0,00" class="form-control">
                </div>

                <button type="submit" class="btn-custom" style="margin-top: 15px;">
                    <i class="fas fa-save"></i> Salvar no Estoque
                </button>
            </form>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: rodape}"></div>

    <script>
        var modal = document.getElementById("modalProduto");

        function abrirModal() {
            modal.style.display = "block";
        }

        function fecharModal() {
            modal.style.display = "none";
        }

        // Fecha se clicar fora da janela do modal
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
</body>
</html>