<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Prontuário - SpeedMedical</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        .prontuario-container { display: grid; grid-template-columns: 1fr 2fr; gap: 25px; align-items: start; }
        .profile-card, .history-card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .profile-card { border-top: 5px solid #20c997; text-align: center; }
        .profile-avatar { width: 100px; height: 100px; background-color: #e6fffa; color: #20c997; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px auto; }
        .data-row { text-align: left; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
        .data-row strong { display: block; color: #444; font-size: 0.85rem; margin-top: 10px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f0f2f5; padding-bottom: 15px; }
        .section-header h3 { color: #20c997; display: flex; align-items: center; gap: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; color: #888; font-size: 0.85rem; text-transform: uppercase; }
        td { padding: 15px 12px; border-bottom: 1px solid #f0f2f5; color: #555; }
        .status-tag { padding: 5px 10px; border-radius: 15px; font-size: 0.75rem; font-weight: bold; display: inline-block; }
        .status-Concluído { background-color: #d4edda; color: #155724; }
        .status-Agendado { background-color: #fff3cd; color: #856404; }
        @media (max-width: 768px) { .prontuario-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <nav>
        <h1>SpeedMedical</h1>
        <div class="user-info">
            <a th:href="@{/home}" class="btn-sair" style="margin-right: 15px; background: transparent; border: 1px solid white;">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
            Olá, <span th:text="${usuario?.nome != null ? usuario.nome : #authentication.name}">Usuário</span>
        </div>
    </nav>

    <main>
        <h2 class="page-title">Prontuário do Paciente</h2>

        <div class="prontuario-container">
            
            <div class="profile-card">
                <div class="profile-avatar"><i class="fas fa-user-circle"></i></div>
                <h3 th:text="${paciente.nome}">Nome</h3>
                <p>Paciente SpeedMedical</p>

                <div class="data-row">
                    <strong>CPF</strong> <span th:text="${paciente.cpf}">000</span>
                    <strong>Cartão SUS</strong> <span th:text="${paciente.cartaoSus != null ? paciente.cartaoSus : '---'}">000</span>
                    <strong>Telefone</strong> <span th:text="${paciente.telefone}">000</span>
                    <strong>Endereço</strong> 
                    <span th:text="${paciente.logradouro} + ', ' + ${paciente.numero}">Rua</span>
                    <span th:text="${paciente.bairro} + ' - ' + ${paciente.cidade} + '/' + ${paciente.uf}" style="display:block; font-size:0.85rem;">Cidade</span>
                </div>
                
                <a th:href="@{/pacientes/editar}" style="display:block; margin-top:20px; color:#20c997; font-weight:bold; font-size:0.9rem; cursor: pointer;">
                    <i class="fas fa-pen"></i> Atualizar Dados
                </a>
            </div>

            <div class="history-card">
                <div class="section-header">
                    <h3><i class="fas fa-notes-medical"></i> Histórico de Procedimentos</h3>
                    
                    <a th:href="@{/agendamentos/novo}" class="btn-custom" style="text-decoration:none; padding: 10px 20px; width: auto; color: white;">
                        <i class="fas fa-plus"></i> Novo Agendamento
                    </a>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Procedimento</th>
                            <th>Profissional</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="proc : ${historico}">
                            <td>
                                <strong th:text="${proc.procedimento}" style="color:#333;">Proc</strong>
                                <br><small style="color:#888;">SpeedMedical</small>
                            </td>
                            <td th:text="${proc.profissional}">Dr.</td>
                            <td th:text="${#temporals.format(proc.dataHora, 'dd/MM/yyyy HH:mm')}">Data</td>
                            <td><span th:class="'status-tag status-' + ${proc.status}" th:text="${proc.status}">Status</span></td>
                            <td><a href="#" style="color:#20c997;"><i class="fas fa-eye"></i></a></td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(historico)}"><td colspan="5" style="text-align:center;">Nenhum registro.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    <footer>&copy; 2025 SpeedMedical</footer>
</body>
</html>